var EXPRESS=EXPRESS||{};!function(a,b){var c=Namespace("FUNCTIONS",b);c.redirect=function(a){var b=new RegExp("^(?:[a-z]+:)?//","i");return b.test(a)?window.location.assign(a):(a.lastIndexOf(".")===-1&&(a+=".html"),window.location.assign(a))}}(jQuery,EXPRESS),function(a,b){var c=Namespace("LOCALSTORAGE",b);c.Options={appID:"express",aes:!0},c.save=function(b){var c=a.extend({},this.Options,{data:b});return a(window).secStore(c),!0},c.get=function(b){var c,d=b||null,e=a.extend({},this.Options);return e.callback=function(a){c=a},a(window).secStore(e),d?c[d]||!1:c},c.empty=function(){var b=a.extend({},this.Options);return a(window).secStore("empty",b),!0},c.getAccessToken=function(){return this.get("access_token")}}(jQuery,EXPRESS),function(a,b){var c=Namespace("MESSAGES",b);b.FUNCTIONS;c.notify=function(a){return"string"==typeof a?noty({text:a}):noty(a)},c.notifyErrors=function(b){function c(b,d){return a.each(b,function(a,b){"object"!=typeof b?d+=b+"<br/>":d=c(b,d)}),d}var d={layout:"center",type:"error",theme:"relax"},e="Error: <br/>";return"string"!=typeof b?e=c(b,e):e+=b,d.text=e,this.notify(d)}}(jQuery,EXPRESS),function(a,b,c){var d=Namespace("API",b),e=Namespace("API.AJAX",b),f=Namespace("API.UTILITY",b);d.url="undefined"!=typeof EXPRESS_API_URL?EXPRESS_API_URL:"http://express.dev/api",d.call=function(a){var b=f.prepareSettings(a);return e.ajax(b)},d.get=function(a){return a.method="GET",this.call(a)},d.post=function(a){return a.method="POST",this.call(a)},d.Login=function(b){var c={url:"/auth/login",token:null};return b=a.extend(b,c),this.post(b)},d.validateAccessToken=function(a){return this.get({url:"/token/validate",token:a,beforeSend:function(b,c){a||b.abort()}})}}(jQuery,EXPRESS,EXPRESS.LOCALSTORAGE),function(a,b){var c=b.AJAX;c.stack={calls:[],active:!1},c.Options={crossDomain:!0,headers:{"X-Requested-With":"XMLHttpRequest"},dataType:"json"},c.setHeader=function(a,b,c){var d=c.headers||{};return d[a]=b,c.headers=d,c},c.ajax=function(b){return a.ajax(b)}}(jQuery,EXPRESS.API),function(a,b,c){var d=b.UTILITY,e=b.AJAX;d.prepareSettings=function(b){var d=a.extend({},e.Options,b);return d.url=this.ConstructUrl(d.url),"undefined"==typeof d.token?e.setHeader("Authorization","Bearer "+c.ApiToken(),d):d.token&&e.setHeader("Authorization","Bearer "+d.token,d),d},d.ConstructUrl=function(a){var c=a.replace(b.url,"");return"/"!==c.charAt(0)&&(c="/"+c),"/"===c.charAt(c.length-1)&&(c=c.slice(0,-1)),b.url+c},d.formatError=function(b){var c={error:"unknown",error_description:""};return"undefined"==typeof b.error_description?c.error_description=String(b):c=a.extend(c,b),c}}(jQuery,EXPRESS.API,EXPRESS.LOCALSTORAGE),function(a,b){var c=Namespace("AUTH",b),d=b.API,e=b.LOCALSTORAGE,f=b.FUNCTIONS;c.check=function(){var a=this.AccessToken();return d.validateAccessToken(a).fail(function(a,b,c){f.redirect("login")})},c.AccessToken=function(){return e.getAccessToken()}}(jQuery,EXPRESS),function(a,b){Namespace("USER",b),b.API,b.LOCALSTORAGE}(jQuery,EXPRESS);var CONTROLLERS=CONTROLLERS||{};!function(a,b){var c=Namespace("APP",b);c.handle=function(){a(".sidebar-toggle").toggleSidebar({target:"#appsidebar"})}}(jQuery,CONTROLLERS),function(a,b){var c=Namespace("LOGIN",b);c.handle=function(){this.startLogin()},c.startLogin=function(){a("form#login").on("submit",this.onSubmitLogin)},c.onSubmitLogin=function(b){b.preventDefault();var c=a(this),d={context:c,data:c.serializeArray(),beforeSend:function(b,c){var d=a('button[type="submit"]',this);d.attr("disabled",!0),d.data("html.cache",d.html()),d.html("Logging in, Please wait...")},complete:function(b,c){var d=a('button[type="submit"]',this);d.attr("disabled",!1),d.html(d.data("html.cache")),d.data("html.cache",null)}};EXPRESS.API.Login(d).done(function(a,b,c){EXPRESS.LOCALSTORAGE.save({access_token:a.api_token}),EXPRESS.FUNCTIONS.redirect("dashboard")}).fail(function(a,b,c){var d=EXPRESS.API.UTILITY.formatError(a.responseJSON);EXPRESS.MESSAGES.notifyErrors(d.error_description)})}}(jQuery,CONTROLLERS),function(a,b){var c=Namespace("SPLASH",b);c.handle=function(){EXPRESS.AUTH.check().done(function(a,b,c){EXPRESS.FUNCTIONS.redirect("dashboard")})}}(jQuery,CONTROLLERS);